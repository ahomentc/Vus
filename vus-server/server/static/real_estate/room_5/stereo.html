<html>
<head>
  <title>My A-Frame Scene</title>
  <script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
  <script src="../js/aframe-stereo-component.min.js"></script>
  <script src='../js/kinematic-body.js'></script>
  <script src="../js/movement-controls.js"></script>
  <script src="../js/touch-controls.js"></script>
  <script src="../js/trackpad-controls.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>

  <script>
    var inversed = false;
    AFRAME.registerComponent("invert_stereo_correctly", {
      init: function() {
      },
      tick: function() {
          var camera = document.querySelector("a-camera")
          var angle = camera.getAttribute("rotation")
          // if y angle over 180, then might need to switch the eyes. For now... But later make sides be non-stereo.

          // convert all negative numbers to positive
          y_angle = angle.y
          if (y_angle < 0){
              y_angle = 360 + y_angle;
          }
          console.log(y_angle)
          if(y_angle > 120 && y_angle < 240 && !inversed){
              document.getElementById("nost").setAttribute('visible', 'false')
              document.getElementById("stl").setAttribute('visible', 'true')
              document.getElementById("str").setAttribute('visible', 'true')
              document.getElementById("stl").setAttribute("src", "#right")
              document.getElementById("str").setAttribute("src", "#left")
              inversed = true;
          }
          else if(y_angle < 60 || y_angle > 330 && inversed){
              document.getElementById("nost").setAttribute('visible', 'false')
              document.getElementById("stl").setAttribute('visible', 'true')
              document.getElementById("str").setAttribute('visible', 'true')
              document.getElementById("stl").setAttribute("src", "#left")
              document.getElementById("str").setAttribute("src", "#right")
              inversed = false;    
          }
          // make non stereo
          else if((y_angle >= 60 && y_angle <= 120) || (y_angle >= 240 && y_angle <= 330)){
              document.getElementById("nost").setAttribute('visible', 'true')
              document.getElementById("stl").setAttribute('visible', 'false')
              document.getElementById("str").setAttribute('visible', 'false')
          }
          // if x angle less than 65, then switch to non stereo
      }
  });
  </script>
</head>
<body>
    <a-scene>
        <a-assets>
          <img id="left" src="assets/left.jpg" />
          <img id="right" src="assets/right.jpg" />
        </a-assets>

      <!-- we tell here the camera to render (outside VR mode, in monoscopic mode) everything without the 'stereo' component active
      and it it's active, only render those entities in the 'left' eye -->

      <a-entity id="player" movement-controls="speed: 0.1">
        <a-camera invert_stereo_correctly look-controls position="0 0 0" stereocam="eye:left;"></a-camera>
        <a-entity id="left_hand" hand-controls="left"></a-entity>
        <a-entity id="right_hand" hand-controls="right"></a-entity>
      </a-entity>

      <a-sky id="stl" src="#left" radius="5" position="0 1.6 0" rotation='0 -90 0' stereo="eye:left" visible='false'></a-sky> 
      <a-sky id="str" src="#right" radius="5" position="0 1.6 0" rotation='0 -90 0' stereo="eye:right" visible='false'></a-sky> 

      <a-sky id="nost" src="#left" radius="5" position="0 1.6 0" rotation='0 -90 0'></a-sky> 

    </a-scene>

<script>
st_enabled = false;
document.body.addEventListener('abuttondown', function (evt) {
    if(!st_enabled){
        document.getElementById("nost").setAttribute('visible', 'false')
        document.getElementById("stl").setAttribute('visible', 'true')
        document.getElementById("str").setAttribute('visible', 'true')
        st_enabled = true;
    }
    else{
        document.getElementById("nost").setAttribute('visible', 'true')
        document.getElementById("stl").setAttribute('visible', 'false')
        document.getElementById("str").setAttribute('visible', 'false')
        st_enabled = false;
    }
});

</script>

 </body>
 </html>